<!DOCTYPE html> <html><head>
		<title>ExcelHelper.cs</title>
		<base href="..\..\..\../">
		<meta id="root-path" root-path="..\..\..\../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="Mindmap Obsidian - ExcelHelper.cs">
		<meta property="og:title" content="ExcelHelper.cs">
		<meta property="og:description" content="Mindmap Obsidian - ExcelHelper.cs">
		<meta property="og:type" content="website">
		<meta property="og:url" content="volvo/it-ie4.0/csharp/rm-tool/excelhelper.cs.html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="Mindmap Obsidian">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="ExcelHelper.cs">ExcelHelper.cs</h1><div class="el-p"><p dir="auto">The <a href="?query=tag:Excelhelper" class="tag" target="_blank" rel="noopener nofollow">#Excelhelper</a> class provides utility functions related to handling Microsoft Excel processes. It includes methods to check if Excel is running and to close all running instances of Excel. Here's a breakdown of the key components:</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>DLL Imports</strong>:
<ul>
<li data-line="2" dir="auto">The class uses PInvoke (<code>[DllImport]</code>) to import functions from the Windows API (<code>user32.dll</code>). These functions include <code>EnumWindows</code> (to enumerate top-level windows) and <code>GetWindowThreadProcessId</code> (to retrieve the process ID associated with a window handle). These functions are set up for potential use with Excel process management.</li>
</ul>
</li>
<li data-line="3" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Checking if Excel is Running</strong>:
<ul>
<li data-line="5" dir="auto">The <code>IsExcelRunning</code> method checks if any instances of Excel are currently running by retrieving all processes named "EXCEL" using <code>Process.GetProcessesByName("EXCEL")</code>. It returns <code>true</code> if any Excel processes are found, otherwise <code>false</code>.</li>
</ul>
</li>
<li data-line="6" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Closing All Excel Instances</strong>:
<ul>
<li data-line="8" dir="auto">The <code>CloseAllExcelInstances</code> method forcibly terminates all running instances of Excel by iterating through the list of processes named "EXCEL" and calling <code>process.Kill()</code> on each one. This is useful for ensuring that no lingering Excel processes interfere with the application.</li>
</ul>
</li>
</ul></div><div class="el-pre"><pre class="language-csharp" tabindex="0"><code data-line="0" class="language-csharp is-loaded"><span class="token keyword">using</span> <span class="token namespace">ClosedXML<span class="token punctuation">.</span>Excel</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">RMtool</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ExcelHelper</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Import the EnumWindows function from user32.dll for enumerating top-level windows</span>
        <span class="token punctuation">[</span><span class="token function">DllImport</span><span class="token punctuation">(</span><span class="token string">"user32.dll"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">EnumWindows</span><span class="token punctuation">(</span><span class="token class-name">EnumWindowsProc</span> lpEnumFunc<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Delegate for the callback function used by EnumWindows</span>
        <span class="token keyword">private</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">EnumWindowsProc</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hWnd<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Import GetWindowThreadProcessId function to get the process ID associated with a window handle</span>
        <span class="token punctuation">[</span><span class="token function">DllImport</span><span class="token punctuation">(</span><span class="token string">"user32.dll"</span><span class="token punctuation">,</span> CharSet <span class="token operator">=</span> CharSet<span class="token punctuation">.</span>Auto<span class="token punctuation">,</span> SetLastError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetWindowThreadProcessId</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hWnd<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">int</span></span> processId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Check if any Excel processes are currently running</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsExcelRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Get all processes named "EXCEL" and check if any are running</span>
            <span class="token class-name"><span class="token keyword">var</span></span> excelProcesses <span class="token operator">=</span> System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process<span class="token punctuation">.</span><span class="token function">GetProcessesByName</span><span class="token punctuation">(</span><span class="token string">"EXCEL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> excelProcesses<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Return true if there are any running Excel processes</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Close all running instances of Excel</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CloseAllExcelInstances</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Get all processes named "EXCEL"</span>
            <span class="token class-name"><span class="token keyword">var</span></span> excelProcesses <span class="token operator">=</span> System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process<span class="token punctuation">.</span><span class="token function">GetProcessesByName</span><span class="token punctuation">(</span><span class="token string">"EXCEL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> process <span class="token keyword">in</span> excelProcesses<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                process<span class="token punctuation">.</span><span class="token function">Kill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Forcefully terminate each Excel process</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">The <a href="?query=tag:ReadExcelData" class="tag" target="_blank" rel="noopener nofollow">#ReadExcelData</a> method reads data from a specified Excel file, processes the data into a <code>DataTable</code>, and counts occurrences of 'Y' in a specific column. Here are the key steps:</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Check for Running Excel Instances</strong>:
<ul>
<li data-line="1" dir="auto">The method checks if Excel is currently running. If so, it prompts the user to close Excel instances or allows automatic closure. The method exits if Excel is not closed, to prevent file access conflicts.</li>
</ul>
</li>
<li data-line="3" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Open and Validate Excel Workbook</strong>:
<ul>
<li data-line="4" dir="auto">Loads the Excel workbook from the provided file path using <code>ClosedXML</code>. It looks for a specific worksheet named "2.) Maximo Data List (MDL)" and validates certain column headers to ensure the correct structure before proceeding.</li>
</ul>
</li>
<li data-line="6" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Extract and Process Data</strong>:
<ul>
<li data-line="7" dir="auto">Initializes a <code>DataTable</code> and populates it with columns based on the headers in row 7 of the worksheet.</li>
<li data-line="8" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>It determines the last row with data in column C and reads rows starting from row 8 up to this last row, applying specific rules:
<ul>
<li data-line="9" dir="auto">Rows are skipped if both key columns (K and L) are empty.</li>
<li data-line="10" dir="auto">It validates the status in column C to be either "New" or "Ongoing".</li>
<li data-line="11" dir="auto">It processes values in columns K and L by removing non-alphanumeric characters and converting to lowercase.</li>
</ul>
</li>
</ul>
</li>
<li data-line="13" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Count Specific Values</strong>:
<ul>
<li data-line="14" dir="auto">Counts occurrences of the 'Y' value in column AE (31) during row processing.</li>
</ul>
</li>
<li data-line="16" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Return Results</strong>:
<ul>
<li data-line="17" dir="auto">Returns the populated <code>DataTable</code> along with the count of 'Y' values in column AE, providing both the data structure and a specific metric from the worksheet.</li>
</ul>
</li>
</ul></div><div class="el-pre"><pre class="language-csharp" tabindex="0"><code data-line="0" class="language-csharp is-loaded"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token punctuation">(</span>DataTable<span class="token punctuation">?</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span></span> <span class="token function">ReadExcelData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> filePath<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Check if Excel is running</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsExcelRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Prompt the user to close Excel instances or allow automatic closure</span>
        <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>
            <span class="token string">"There are running instances of Excel. Choose an option:"</span><span class="token punctuation">,</span>
            <span class="token string">"Excel Running"</span><span class="token punctuation">,</span>
            MessageBoxButton<span class="token punctuation">.</span>YesNo<span class="token punctuation">,</span>
            MessageBoxImage<span class="token punctuation">.</span>Warning<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// If the user chooses 'Yes', close all running Excel instances</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> MessageBoxResult<span class="token punctuation">.</span>Yes<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CloseAllExcelInstances</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// If the user chooses 'No', ask them to close Excel manually</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>
                <span class="token string">"Please close all Excel instances manually and try again."</span><span class="token punctuation">,</span>
                <span class="token string">"Operation Cancelled"</span><span class="token punctuation">,</span>
                MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span>
                MessageBoxImage<span class="token punctuation">.</span>Information<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Exit if Excel instances are still running</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">DataTable<span class="token punctuation">?</span></span> mdlTable <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// Initialize the DataTable to store Excel data</span>
    <span class="token class-name"><span class="token keyword">int</span></span> yCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Counter for 'Y' values found in column AE</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Load the Excel workbook from the specified file path</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> workbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">XLWorkbook</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> sheetName <span class="token operator">=</span> <span class="token string">"2.) Maximo Data List (MDL)"</span><span class="token punctuation">;</span> <span class="token comment">// Expected worksheet name</span>
            <span class="token comment">// Check if the specified worksheet exists</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>workbook<span class="token punctuation">.</span>Worksheets<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>ws <span class="token operator">=&gt;</span> ws<span class="token punctuation">.</span>Name <span class="token operator">==</span> sheetName<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Show an error if the worksheet is not found</span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>
                    <span class="token string">"The name of the MDL excel sheet is not correct. It should be : \"2.) Maximo Data List (MDL)\"."</span><span class="token punctuation">,</span>
                    <span class="token string">"Worksheet Not Found"</span><span class="token punctuation">,</span>
                    MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span>
                    MessageBoxImage<span class="token punctuation">.</span>Error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Exit if the worksheet is not found</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Access the specified worksheet</span>
            <span class="token class-name"><span class="token keyword">var</span></span> worksheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span><span class="token function">Worksheet</span><span class="token punctuation">(</span>sheetName<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Define the header row (row 7)</span>
            <span class="token class-name"><span class="token keyword">var</span></span> headerRow <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Validate the names of columns 11 and 12 (K and L)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>headerRow<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"MANUFACTURE ART. NO.\n(M)"</span> <span class="token operator">||</span>
                headerRow<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"TYPE DESIGNATION\n(M)"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Show an error if the expected column headers are not found</span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>
                    <span class="token string">"The name of the columns in row 7 are incorrect. Column 10 should be 'MANUFACTURER (M)' and Column 11 should be 'TYPE DESIGNATION (M)'."</span><span class="token punctuation">,</span>
                    <span class="token string">"Column Name Mismatch"</span><span class="token punctuation">,</span>
                    MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span>
                    MessageBoxImage<span class="token punctuation">.</span>Error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Exit if column headers are incorrect</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Initialize the DataTable and add columns based on the header row</span>
            mdlTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> cell <span class="token keyword">in</span> headerRow<span class="token punctuation">.</span><span class="token function">CellsUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                mdlTable<span class="token punctuation">.</span>Columns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>cell<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Started conversion of Excel to DataTable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Find the last row with data in column C to limit processing to relevant rows</span>
            <span class="token class-name"><span class="token keyword">int</span></span> lastRowWithDataInColumnC <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> row <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> row <span class="token operator">&lt;=</span> worksheet<span class="token punctuation">.</span><span class="token function">LastRowUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RowNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> row<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> cellValue <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>cellValue<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    lastRowWithDataInColumnC <span class="token operator">=</span> row<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Read data from the worksheet starting from row 8 to the last row with data in column C</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> rowNum <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> rowNum <span class="token operator">&lt;=</span> lastRowWithDataInColumnC<span class="token punctuation">;</span> rowNum<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> row <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Row</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> dataRow <span class="token operator">=</span> mdlTable<span class="token punctuation">.</span><span class="token function">NewRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name"><span class="token keyword">bool</span></span> hasData <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// Flag to check if the row contains relevant data</span>
                <span class="token class-name"><span class="token keyword">bool</span></span> skipRow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// Flag to determine if the row should be skipped</span>

                <span class="token comment">// Populate DataRow with cell values</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> colIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> colIndex <span class="token operator">&lt;=</span> mdlTable<span class="token punctuation">.</span>Columns<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> colIndex<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> cell <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>colIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// Skip the row if both columns K (11) and L (12) are empty</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>colIndex <span class="token operator">==</span> <span class="token number">11</span> <span class="token operator">&amp;&amp;</span> cell<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        skipRow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// Exit the inner loop if both columns are empty</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// Check the second column (C) for specific values ('New' or 'Ongoing')</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>colIndex <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"New"</span> <span class="token operator">||</span> cell<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Ongoing"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            hasData <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Mark row as having valid data</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token comment">// Show a warning if the state of the row is not set or incorrect</span>
                            MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"The state of the row at line </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">rowNum</span><span class="token punctuation">}</span></span><span class="token string"> is not set or correct (Expected 'New' or 'Ongoing')."</span></span><span class="token punctuation">,</span>
                            <span class="token string">"Invalid State"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Warning<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//return (null, 0); // Optional: exit if state is invalid</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// Process and normalize values in columns K (11) and L (12)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>colIndex <span class="token operator">==</span> <span class="token number">11</span> <span class="token operator">||</span> colIndex <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name"><span class="token keyword">string</span></span> processedValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span></span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">.</span>IsLetterOrDigit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        dataRow<span class="token punctuation">[</span>colIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> processedValue<span class="token punctuation">;</span> <span class="token comment">// Add processed value to DataRow</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{</span>
                        <span class="token comment">// Add the cell value or DBNull if the cell is empty</span>
                        dataRow<span class="token punctuation">[</span>colIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> DBNull<span class="token punctuation">.</span>Value <span class="token punctuation">:</span> cell<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Count occurrences of 'Y' in column AE (31)</span>
                <span class="token class-name"><span class="token keyword">var</span></span> aeCell <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>aeCell<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> aeCell<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Y"</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    yCount<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// Increment the count for 'Y' values</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Add the DataRow to the DataTable only if it has data and should not be skipped</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hasData <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>skipRow<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Adding row </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">rowNum</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> dataRow<span class="token punctuation">.</span>ItemArray<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mdlTable<span class="token punctuation">.</span>Rows<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dataRow<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Log the exception if an error occurs while reading the Excel file</span>
        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Error reading Excel file: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ex<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span><span class="token punctuation">;</span> <span class="token comment">// Rethrow the exception to be handled by the calling code</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Print the count of 'Y' values in column AE</span>
    Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Total 'Y' values in column AE: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">yCount</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Return the populated DataTable and count of 'Y' values</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>mdlTable<span class="token punctuation">,</span> yCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">The <a href="?query=tag:CompareFunction" class="tag" target="_blank" rel="noopener nofollow">#CompareFunction</a> method processes data in an Excel file by comparing entries against provided lists of exact matches, fuzzy matches, and unmatched items. It colors and fills specific cells based on these comparisons and returns the counts of matched and unmatched cells. Here are the key steps:</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Open and Validate Excel Worksheet</strong>:
<ul>
<li data-line="1" dir="auto">The method opens the specified Excel file and accesses a worksheet named "2.) Maximo Data List (MDL)". It validates that column 25 is correctly named "MAXIMO ITEM NO." to ensure the correct structure for data processing.</li>
</ul>
</li>
<li data-line="3" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Exact Matches</strong>:
<ul>
<li data-line="4" dir="auto">The method iterates through the <code>exactMatchedList</code> and fills corresponding cells in column 25 with the item numbers, coloring them green. Additional cells are filled if the <code>checkBoxFiller</code> option is selected.</li>
</ul>
</li>
<li data-line="6" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Handling Duplicates</strong>:
<ul>
<li data-line="7" dir="auto">If <code>checkBoxDoubles</code> is selected, the method groups rows by values in columns 10 and 11 to find duplicates. It fills cells with existing item numbers for duplicates under specific conditions.</li>
</ul>
</li>
<li data-line="9" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Fuzzy Matches</strong>:
<ul>
<li data-line="10" dir="auto">The method processes the <code>fuzzyMatchedList</code>, filling corresponding cells in column 25 with fuzzy matched values and coloring them yellow. It fills additional cells if the <code>checkBoxFiller</code> option is enabled.</li>
</ul>
</li>
<li data-line="12" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Unmatched Items</strong>:
<ul>
<li data-line="13" dir="auto">The method processes the <code>unmatchedManufacturerNumsList</code> by marking unmatched cells in column 25 with "Not Found" and coloring them purple.</li>
</ul>
</li>
<li data-line="15" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Counting and Saving</strong>:
<ul>
<li data-line="16" dir="auto">It counts all colored cells in column 25 to determine the number of matched (green or yellow) and unmatched (purple) cells. The workbook is saved after all modifications.</li>
</ul>
</li>
<li data-line="18" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Return Results</strong>:
<ul>
<li data-line="19" dir="auto">The method returns the counts of matched and unmatched cells, providing metrics on how many items were matched exactly, matched fuzzily, or not found in the comparison process.</li>
</ul>
</li>
</ul></div><div class="el-pre"><pre class="language-csharp" tabindex="0"><code data-line="0" class="language-csharp is-loaded"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token punctuation">(</span><span class="token keyword">int</span> matchedCells<span class="token punctuation">,</span> <span class="token keyword">int</span> unmatchedCells<span class="token punctuation">)</span></span> <span class="token function">CompareFunction</span><span class="token punctuation">(</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> filepath<span class="token punctuation">,</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>MaximoData<span class="token punctuation">&gt;</span></span> exactMatchedList<span class="token punctuation">,</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>MaximoData<span class="token punctuation">&gt;</span></span> fuzzyMatchedList<span class="token punctuation">,</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>Tuple<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> unmatchedManufacturerNumsList<span class="token punctuation">,</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> checkBoxFiller<span class="token punctuation">,</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> checkBoxDoubles<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Open the Excel file and write the values from the matched lists to column 25 in the Excel file</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> workbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">XLWorkbook</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Access the worksheet named "2.) Maximo Data List (MDL)"</span>
        <span class="token class-name"><span class="token keyword">var</span></span> worksheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span><span class="token function">Worksheet</span><span class="token punctuation">(</span><span class="token string">"2.) Maximo Data List (MDL)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Validate the name of column 25</span>
        <span class="token class-name"><span class="token keyword">var</span></span> headerRow <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>headerRow<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"MAXIMO\nITEM NO."</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Show an error if the expected column header is not found</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>
                <span class="token string">"The name of column 25 is incorrect. It should be 'MAXIMO ITEM NO.'."</span><span class="token punctuation">,</span>
                <span class="token string">"Column Name Mismatch"</span><span class="token punctuation">,</span>
                MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span>
                MessageBoxImage<span class="token punctuation">.</span>Error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Exit the method if the column name does not match</span>
        <span class="token punctuation">}</span>

        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Start Filling ExactMatches"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Function to fill a cell with a value and set its background color</span>
        <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FillCell</span><span class="token punctuation">(</span><span class="token class-name">IXLCell</span> cell<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">XLColor</span> color<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            cell<span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            cell<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>Fill<span class="token punctuation">.</span>BackgroundColor <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Function to find the row index based on the Index value</span>
        <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">FindRowIndex</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> index<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> worksheet<span class="token punctuation">.</span><span class="token function">LastRowUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RowNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> index<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> i<span class="token punctuation">;</span> <span class="token comment">// Return the row index if a match is found</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Return -1 if no matching row is found</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Iterate through each item in the exactMatchedList collection</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> exactMatchedList<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> rowIndex <span class="token operator">=</span> <span class="token function">FindRowIndex</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>rowIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Fill cells with values and set background color to green for exact matches</span>
                <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>ITEMNUM<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Fill additional cells if the checkbox filler option is selected</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>checkBoxFiller<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Y"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"N"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"N"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Y"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"N"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"N"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Y"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"N"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"No matching row found for Index: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">item<span class="token punctuation">.</span>INDEX</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Done Filling ExactMatches"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Handle duplicate entries if the checkbox doubles option is selected</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>checkBoxDoubles<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Find groups of rows with duplicate values in columns 10 and 11</span>
            <span class="token class-name"><span class="token keyword">var</span></span> duplicateGroups <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Rows</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> worksheet<span class="token punctuation">.</span><span class="token function">LastRowUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RowNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>row <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                    <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>g <span class="token operator">=&gt;</span> g<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>g<span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Item1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> g<span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Item2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ensure at least one of the keys is not null</span>

            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">group</span> <span class="token keyword">in</span> duplicateGroups<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Find the first row with an existing ITEMNUM in column 25 that does not contain "Not Found"</span>
                <span class="token class-name"><span class="token keyword">var</span></span> firstRowWithItemNum <span class="token operator">=</span> <span class="token keyword">group</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>row <span class="token operator">=&gt;</span>
                    <span class="token operator">!</span>row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRowWithItemNum <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword">string</span></span> itemNum <span class="token operator">=</span> firstRowWithItemNum<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> row <span class="token keyword">in</span> <span class="token keyword">group</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token class-name"><span class="token keyword">var</span></span> cell <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// Check if the cell is empty and the third column (C) value is "New" or "Ongoing"</span>
                        <span class="token class-name"><span class="token keyword">string</span></span> column3Value <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                            <span class="token punctuation">(</span>column3Value <span class="token operator">==</span> <span class="token string">"New"</span> <span class="token operator">||</span> column3Value <span class="token operator">==</span> <span class="token string">"Ongoing"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                            <span class="token operator">!</span>itemNum<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token function">FillCell</span><span class="token punctuation">(</span>cell<span class="token punctuation">,</span> itemNum<span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>LightGreen<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fill empty cells in column 25 with the ITEMNUM</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Start Filling FuzzyMatches"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Iterate through each item in the fuzzyMatchedList collection</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> fuzzyMatchedList<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> rowIndex <span class="token operator">=</span> <span class="token function">FindRowIndex</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>rowIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> cell <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// Fill the cell with fuzzy matched values and set background color to yellow</span>
                    <span class="token function">FillCell</span><span class="token punctuation">(</span>cell<span class="token punctuation">,</span> item<span class="token punctuation">.</span>ITEMNUM<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Yellow<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>checkBoxFiller<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Y"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fill additional cells if filler option is selected</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"No matching row found for Index: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">item<span class="token punctuation">.</span>INDEX</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Done Filling FuzzyMatches"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Start Coloring UnmatchedList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Iterate through each item in the unmatchedManufacturerNumsList collection</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> unmatchedManufacturerNumsList<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">string</span></span> unmatchedNum <span class="token operator">=</span> item<span class="token punctuation">.</span>Item1<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> index <span class="token operator">=</span> item<span class="token punctuation">.</span>Item2<span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">int</span></span> rowIndex <span class="token operator">=</span> <span class="token function">FindRowIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>rowIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> cell10 <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> cell11 <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> cell25 <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Skip coloring if both key columns (10 and 11) are empty</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cell10<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> cell11<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Fill unmatched cells with "Not Found" and set background color to purple</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cell25<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    cell25<span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">"Not Found"</span><span class="token punctuation">;</span>
                    cell25<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>Fill<span class="token punctuation">.</span>BackgroundColor <span class="token operator">=</span> XLColor<span class="token punctuation">.</span>Purple<span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>checkBoxFiller<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token function">FillCell</span><span class="token punctuation">(</span>worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Y"</span><span class="token punctuation">,</span> XLColor<span class="token punctuation">.</span>Green<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"No matching row found for Index: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">index</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Done Coloring UnmatchedList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Count all the colored cells in column 25</span>
        <span class="token class-name"><span class="token keyword">int</span></span> matchedCells <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> unmatchedCells <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">// Iterate through the rows to count matched and unmatched cells based on color</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> worksheet<span class="token punctuation">.</span><span class="token function">LastRowUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RowNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> cellColor <span class="token operator">=</span> worksheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Style<span class="token punctuation">.</span>Fill<span class="token punctuation">.</span>BackgroundColor<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cellColor <span class="token operator">==</span> XLColor<span class="token punctuation">.</span>Green <span class="token operator">||</span> cellColor <span class="token operator">==</span> XLColor<span class="token punctuation">.</span>Yellow<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                matchedCells<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// Increment matched cells count</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cellColor <span class="token operator">==</span> XLColor<span class="token punctuation">.</span>Purple<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                unmatchedCells<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// Increment unmatched cells count</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Save the workbook after all modifications</span>
        workbook<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Return the counts of matched and unmatched cells</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>matchedCells<span class="token punctuation">,</span> unmatchedCells<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-hr"><hr></div><div class="mod-footer mod-ui"></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="volvo\it-ie4.0\csharp\rm-tool\excelhelper.cs.html#ExcelHelper.cs"><div class="tree-item-contents heading-link" heading-name="ExcelHelper.cs"><span class="tree-item-title">ExcelHelper.cs</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>